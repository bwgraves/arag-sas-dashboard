<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>ARAG Bacteria Monitoring</title>
        <link rel="stylesheet" href="https://unpkg.com/chota@latest">
        <link href="style.css?v=2" rel="stylesheet" type="text/css" />
        <script defer data-domain="avonbacteria.bernielabs.co.uk" src="https://plausible.io/js/script.js"></script>
    </head>
    <body>
      <header>
        <div class="container">
          <h1>Avonvale River Action Group Bacteria Watch üö£üèª‚Äç‚ôÇÔ∏è</h1>
        </div>
      </header>
        <div class="container">
            <div class="row">
              <div class="col">
                <div class="dashboard-card">
                  <h2>About this dashboard</h2>
                  <p>This dashboard presents bacterial monitoring data from <strong>Eckington</strong>, <strong>Fladbury</strong>, and <strong>Bidford</strong>. The charts display key metrics used to assess potential risks to public health and the environment.</p>

                  <p>Bacteria are microscopic organisms found naturally in lakes, rivers, and streams. While most are harmless, some can indicate contamination or pose a risk to humans and wildlife. <strong>Coliform bacteria</strong>, including <em>E. coli</em>, are commonly used as indicators of water pollution, especially from animal or human waste. Elevated levels of these bacteria may suggest recent contamination from sources such as livestock, pets, or sewage.</p>

                  <p>The results are from a professional lab. A standard amount of sample is put on an agar plate (bacterial food) and grown for a set period of time. The number of colonies (dots of bacteria) seen are counted ‚Äî this is the <strong>cfu</strong> ("colony forming units") count given. Environment Agency ratings consider <em>E. coli</em> &lt; 500 cfu and coliforms &lt; 200 cfu as excellent.</p>

                  <p>Monitoring these levels helps scientists and public health officials track changes over time and identify areas where further investigation or action may be needed. Given that they are historic measurements, they should not be used as an indication of whether it is safe to (say) swim or not.</p>
                
                </div>
                <div class="dashboard-card">
                  <h2>Useful Links</h2>
                  <ul>
                    <li><a href="https://avonvaleriver.org" target="_blank">Avonvale River Action Group website</a></li>
                    <li><a href="https://mycloudbase.com/avonvale" target="_blank">Avonvale River Action Group monthly sampling results</a></li>
                    <li>
                      <a href="https://smartsurvey.co.uk/s/avonalerts" target="_blank">Sign up to Avon sewage spill alerts</a>
                      <span class="text-warning">
                        <i>‚ö†Ô∏è Note: This tool checks Severn Trent's public data for reported sewage spills.
                        It may be incomplete and shouldn't be relied on to judge water safety.</i>
                      </span>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col">
                <div class="dashboard-card">
                  <h2>Latest data - 19th May 2025</h2>
                  <table>
                    <thead>
                      <tr>
                        <th>Site</th>
                        <th>E-Coli</th>
                        <th>Enterococci</th>
                        <th>Coliforms</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Eckington</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>Fladbury</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                      </tr>
                      <tr>
                        <td>Bidford</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="chart-keys">
                    <span class="chart-keys__header">Envrionmental Agency Classifcations - <a href="https://datahq.sas.org.uk/wp-content/uploads/2025/01/SAS-Citizen-Science-guidance-on-data-interpretation.pdf" target="_blank">See here for more details</a></span>
                    <div class="chart-keys__key">
                      <span class="colour colour--excellent"></span>
                      <span><strong>Excellent</strong> - E-Coli: ‚â§500, Enterococci: ‚â§200 cfu/100ml (95th percentile)</span>
                    </div>
                    <div class="chart-keys__key">
                      <span class="colour colour--good"></span>
                      <span><strong>Good</strong> - E-Coli: ‚â§1000, Enterococci: ‚â§400 cfu/100ml (95th percentile)</span>
                    </div>
                    <div class="chart-keys__key">
                      <span class="colour colour--sufficient"></span>
                      <span><strong>Sufficient</strong> - E-Coli: ‚â§900, Enterococci: ‚â§330 cfu/100ml (90th percentile)</span>
                    </div>
                    <div class="chart-keys__key">
                      <span class="colour colour--poor"></span>
                      <span><strong>Poor</strong> - Does not meet 'Sufficient' standard</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <section>
                <h2>Eckington</h2>
                <p>Sampled downstream of Eckington Bridge</p>
                <div class="row">
                    <div class="col">
                        <div class="chart dashboard-card">
                            <h3>E-Coli</h3>
                            <canvas data-ecoli data-location="Eckington"></canvas>
                        </div>
                    </div>
                    <div class="col">
                        <div class="chart dashboard-card">
                            <h3>Enterococci</h3>
                            <canvas data-enterocci data-location="Eckington"></canvas>
                        </div>
                    </div>
                    <div class="col">
                      <div class="chart dashboard-card">
                          <h3>Coliforms</h3>
                          <canvas data-coliforms data-location="Eckington"></canvas>
                      </div>
                  </div>
                </div>
            </section>
            <section>
                <h2>Fladbury</h2>
                <p>Sampled just above Fladbury Mill</p>
                <div class="row">
                    <div class="col">
                        <div class="chart dashboard-card">
                            <h3>E-Coli</h3>
                            <canvas data-ecoli data-location="Fladbury"></canvas>
                        </div>
                    </div>
                    <div class="col">
                        <div class="chart dashboard-card">
                            <h3>Enterococci</h3>
                            <canvas data-enterocci data-location="Fladbury"></canvas>
                        </div>
                    </div>
                    <div class="col">
                      <div class="chart dashboard-card">
                          <h3>Coliforms</h3>
                          <canvas data-coliforms data-location="Fladbury"></canvas>
                      </div>
                  </div>
                </div>
            </section>
            <section>
                <h2>Bidford</h2>
                <p>Sampled downstream at Marcliff</p>
                <div class="row">
                    <div class="col">
                        <div class="chart dashboard-card">
                            <h3>E-Coli</h3>
                            <canvas data-ecoli data-location="Bidford"></canvas>
                        </div>
                    </div>
                    <div class="col">
                        <div class="chart dashboard-card">
                            <h3>Enterococci</h3>
                            <canvas data-enterocci data-location="Bidford"></canvas>
                        </div>
                    </div>
                    <div class="col">
                      <div class="chart dashboard-card">
                          <h3>Coliforms</h3>
                          <canvas data-coliforms data-location="Bidford"></canvas>
                      </div>
                  </div>
                </div>
            </section>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
        <script>
          const belowThreshold = 9;
          const aboveThreshold = 1001;

          const bacteriaData = {
            'Eckington': {
              labels: ['27/05/2025', '19/05/2025'],
              ecoli: [70, 9],
              coliforms: [220, 9],
              enterococci: [220, 60]
            },
            'Fladbury': {
              labels: ['27/05/2025', '19/05/2025', '28/04/2025'],
              ecoli: [210, 530, 400],
              coliforms: [810, 1001, 1150],
              enterococci: [9, 9, 30]
            },
            'Bidford': {
              labels: ['27/05/2025', 19/05/2025'],
              ecoli: [460, 40],
              coliforms: [1310, 270],
              enterococci: [80, 9]
            }
          };

          document.addEventListener('DOMContentLoaded', () => {
            const rows = document.querySelectorAll('table tbody tr');

            rows.forEach(row => {
              const siteName = row.cells[0].textContent.trim();
              const siteData = bacteriaData[siteName];

              if (siteData) {
                const ec = siteData.ecoli[0];
                const co = siteData.coliforms[0];
                const ie = siteData.enterococci[0];

                // E. coli cell
                row.cells[1].textContent =
                  ec === belowThreshold ? '<10' :
                  ec === aboveThreshold ? '>1000' :
                  ec ?? '-';

                const ecClass =
                  ec <= 500 ? 'excellent' :
                  ec <= 900 ? 'sufficient' :
                  ec <= 1000 ? 'good' :
                  ec != null ? 'poor' :
                  'unknown';

                row.cells[1].classList.add(`colour--${ecClass}-light`);

                // Coliforms cell (no colouring)
                row.cells[3].textContent =
                  co === belowThreshold ? '<10' :
                  co === aboveThreshold ? '>1000' :
                  co ?? '-';

                // Enterococci cell
                row.cells[2].textContent =
                  ie === belowThreshold ? '<10' :
                  ie === aboveThreshold ? '>1000' :
                  ie ?? '-';

                const ieClass =
                  ie <= 200 ? 'excellent' :
                  ie <= 330 ? 'sufficient' :
                  ie <= 400 ? 'good' :
                  ie != null ? 'poor' :
                  'unknown';

                row.cells[2].classList.add(`colour--${ieClass}-light`);

              } else {
                // Site not found
                row.cells[1].textContent = '-';
                row.cells[2].textContent = '-';
                row.cells[3].textContent = '-';
              }
            });
        
            function renderCharts() {
              const chartConfigs = [
                { 
                  attr: "data-ecoli", 
                  key: "ecoli", 
                  label: "E-Coli CFU/100ml", 
                  color: "#EE5D9F",
                  thresholds: [500, 900, 1000]
                },
                { 
                  attr: "data-coliforms", 
                  key: "coliforms", 
                  label: "Coliforms CFU/100ml", 
                  color: "#5B8DEF" 
                },
                { 
                  attr: "data-enterocci", 
                  key: "enterococci", 
                  label: "Enterococci CFU/100ml", 
                  color: "#6EDCB4",
                  thresholds: [200, 330, 400]
                },
              ];

              chartConfigs.forEach(({ attr, key, label, color, thresholds }) => {
                document.querySelectorAll(`[${attr}]`).forEach(canvas => {
                  const location = canvas.getAttribute('data-location');
                  const locationData = bacteriaData[location];
                  if (!locationData) return;

                  // Build annotation lines if thresholds exist
                  const annotations = thresholds?.map((value, i) => ({
                    type: 'line',
                    yMin: value,
                    yMax: value,
                    borderColor: ['#2ecc71', '#f1c40f', '#e67e22'][i],
                    borderWidth: 2,
                    borderDash: [6, 6],
                    label: {
                      content: ['Excellent', 'Good', 'Sufficient'][i],
                      enabled: false,
                      color: 'black',
                    }
                  })) || [];

                  new Chart(canvas, {
                    type: 'bar',
                    data: {
                      labels: locationData.labels,
                      datasets: [{
                        label,
                        data: locationData[key],
                        borderWidth: 1,
                        backgroundColor: color,
                        maxBarThickness: 100
                      }]
                    },
                    options: {
                      scales: {
                        y: {
                          beginAtZero: true,
                          title: {
                            display: true,
                            text: 'CFU/100ml'
                          },
                        }
                      },
                      borderRadius: 4,
                      plugins: {
                        legend: {
                          display: false
                        },
                        annotation: {
                          annotations: Object.fromEntries(annotations.map((a, i) => [`line${i}`, a]))
                        }
                      }
                    }
                  });
                });
              });
            }
        
            renderCharts();
          });
        </script>
    </body>
</html>
